#
#  $RCSfile$
#  $Author$
#  $Date$
#  $Revision$
#
########################################################################

export_dir = $(HOME)/sfdist
version = 1.4
ct = $(export_dir)/cantera-$(version)
build_ck = @BUILD_CK@
build_clib = @BUILD_CLIB@
build_python = @BUILD_PYTHON@
build_matlab = @BUILD_MATLAB@
os_is_win = @OS_IS_WIN@

LIBDIR=@LIB_DIR@

# removed utils temporarily
all: kernel cxxlib hdr-collect clib python matlab utils

win: python matlab

install: hdr-install kernel-install data-install python-install matlab-install tools-install finish-install

win-install: hdr-install win-kernel-install data-install python-install matlab-install finish-install

demos: example_codes

kernel: info 
	@INSTALL@ -d @buildlib@
	rm -f @buildlib@/*.a
	rm -f @buildlib@/*.so
	cd ext; @MAKE@
	cd Cantera/src; @MAKE@

clib: 
	cd Cantera/clib/src; @MAKE@
	ranlib @buildlib@/*.a

cxxlib: 
	cd Cantera/cxx; @MAKE@

utils:
	cd tools; @MAKE@

kernel-install:
	@INSTALL@ -d @prefix@/lib/cantera
	rm -f @prefix@/lib/cantera/*
	@INSTALL@ -m 644 @buildlib@/*.a @prefix@/lib/cantera
	cd Cantera/clib/src; @MAKE@ install
	ranlib @prefix@/lib/cantera/*.a

win-kernel-install:
	@INSTALL@ -d @prefix@/lib/cantera
	rm -f @prefix@/lib/cantera/*
	@INSTALL@ -m 644 lib/*.lib @prefix@/lib/cantera

data-install:
	@INSTALL@ -d @prefix@/cantera/data
	@INSTALL@ -m 644 data/inputs/elements.xml @prefix@/cantera/data
	@INSTALL@ -m 644 data/inputs/*.cti @prefix@/cantera/data

tools-install:
	cd tools; @MAKE@ install

hdr-install:
	@INSTALL@ -d @prefix@/include
	cp -r -f build/include/cantera @prefix@/include

hdr-collect:
	@INSTALL@ -d build/include/cantera
	rm -r -f build/include/cantera/*
	@INSTALL@ -d build/include/cantera/kernel
	@INSTALL@ -d build/include/cantera/kernel/oneD
	@INSTALL@ -d build/include/cantera/kernel/zeroD
	@INSTALL@ -d build/include/cantera/kernel/converters
	@INSTALL@ -d build/include/cantera/kernel/transport
	@INSTALL@ include/*.h build/include/cantera
	@INSTALL@ config.h build/include/cantera
	@INSTALL@ Cantera/src/*.h build/include/cantera/kernel
	@INSTALL@ Cantera/src/oneD/*.h build/include/cantera/kernel/oneD
	@INSTALL@ Cantera/src/zeroD/*.h build/include/cantera/kernel/zeroD
	@INSTALL@ Cantera/src/converters/*.h build/include/cantera/kernel/converters
	@INSTALL@ Cantera/src/transport/*.h build/include/cantera/kernel/transport



python: 
ifeq ($(build_python),1)
ifeq ($(os_is_win),0)
	cd Cantera/python; @MAKE@
else
	cd Cantera/python; @MAKE@ win
endif
endif

python-install:
ifeq ($(build_python),1)
	cd Cantera/python; @MAKE@ install
	@INSTALL@ -d @prefix@/cantera/demos/python
	@INSTALL@ Cantera/python/examples/*.py @prefix@/cantera/demos/python
	@INSTALL@ -d @prefix@/cantera/tutorials/python
	@INSTALL@ Cantera/python/tutorial/*.py \
                @prefix@/cantera/tutorials/python
	chown -R @username@ @prefix@/cantera/demos/python
	chown -R @username@ @prefix@/cantera/tutorials/python
endif

matlab:
ifeq ($(build_matlab),1)
	cd Cantera/matlab; @MAKE@
endif

win-matlab:
ifeq ($(build_matlab),1)
	cd Cantera/matlab; @MAKE@ win
endif

matlab-install:
ifeq ($(build_matlab),1)
	cd Cantera/matlab; @MAKE@ install
	@INSTALL@ -d @prefix@/cantera/demos/matlab
	@INSTALL@ Cantera/matlab/cantera/examples/*.m @prefix@/cantera/demos/matlab
	@INSTALL@ -d @prefix@/cantera/tutorials/matlab
	@INSTALL@ Cantera/matlab/cantera/tutorial/*.m @prefix@/cantera/tutorials/matlab
	chown -R @username@ @prefix@/cantera/demos/matlab
	chown -R @username@ @prefix@/cantera/tutorials/matlab
endif

finish-install:
	@INSTALL@ -d @prefix@/bin
	@INSTALL@ bin/ck2cti* @prefix@/bin
	@INSTALL@ -d @prefix@/doc
	@INSTALL@ doc/*.pdf @prefix@/doc
	@INSTALL@ -d @prefix@/cantera/demos/c++
	@INSTALL@ examples/cxx/*.cpp @prefix@/cantera/demos/c++
	@INSTALL@ examples/cxx/*.h @prefix@/cantera/demos/c++
	@INSTALL@ examples/cxx/Makefile @prefix@/cantera/demos/c++
	chown -R @username@ @prefix@/cantera/demos/c++
	@INSTALL@ -d @prefix@/cantera/demos/f77
	@INSTALL@ Cantera/fortran/f77demos/*.f @prefix@/cantera/demos/f77
	@INSTALL@ tools/templates/f77/demo_ftnlib.cpp @prefix@/cantera/demos/f77
	@INSTALL@ Cantera/fortran/f77demos/*.txt @prefix@/cantera/demos/f77
	@INSTALL@ Cantera/fortran/f77demos/f77demos.mak @prefix@/cantera/demos/f77/Makefile
	chown -R @username@ @prefix@/cantera/demos/f77

	@INSTALL@ README*.txt @prefix@/cantera
	@INSTALL@ License.* @prefix@/cantera

	(PYTHONPATH=''; @PYTHON_CMD@ tools/bin/finish_install.py @prefix@ @PYTHON_CMD@)
#@INSTALL@ bin/ctmkmf @prefix@/bin/ctnew
#@INSTALL@ bin/cxx_examples @prefix@/cantera/demos/c++



example_codes:
	(cd examples/cxx; @MAKE@)

test: example_codes
	cd test_problems; @MAKE@ all
	cd test_problems; @MAKE@ test

uninstall:
	rm -r -f @prefix@/include/cantera
	rm -r -f @prefix@/cantera
	rm -r -f @prefix@/lib/cantera
	rm -r -f @prefix@/matlab/toolbox/cantera

clean:
	rm -f *.*~ @buildlib@/*.* 
	cd Cantera; @MAKE@ clean
	cd tools; @MAKE@ clean
	cd ext; @MAKE@ clean
	cd test_problems; @MAKE@ clean
	cd examples; @MAKE@ clean

docs:
	cd tools/doxygen/Cantera; doxygen Cantera.cfg

depends:
	cd Cantera; @MAKE@ depends
	cd tools; @MAKE@ depends

export:
	@INSTALL@ -d $(export_dir)
	if (test -d $(ct)); then rm -r -f $(ct); fi
	cd $(export_dir); cvs export  -D 1/01/2010 cantera
	cd $(export-dir); mv cantera $(ct)
	cd $(ct); rm -r -f Cantera/matlab/cantera/@Thermo

pack: export
	(cd $(export_dir); \
          rm -f cantera-$(version).tar.gz; \
          tar cvf cantera-$(version).tar cantera-$(version)/*; \
	  gzip cantera-$(version).tar)

post: pack
	(cd $(export_dir); \
	$(HOME)/ctpost cantera-$(version).tar.gz 1.3.5/src)


info:
	echo '#define CANTERA_ROOT "@prefix@/cantera"' > include/ctdir.h




